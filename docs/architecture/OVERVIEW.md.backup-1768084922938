# MemoryJS - Project Overview

**Version**: 1.0.0
**Last Updated**: 2026-01-10

## What Is This?

MemoryJS is a **TypeScript knowledge graph library** for managing entities, relations, and observations with advanced search capabilities. It provides the core foundation for building knowledge management systems and can be used as a library in other applications or as the backend for MCP servers.

## Key Capabilities

| Feature | Description |
|---------|-------------|
| **Knowledge Graph** | Store entities and relations in a flexible graph structure |
| **Multiple Backends** | JSONL (human-readable) or SQLite (indexed, FTS5) storage |
| **Hierarchical Nesting** | Parent-child relationships for tree organization |
| **Advanced Search** | Basic, TF-IDF ranked, boolean, fuzzy, semantic, and hybrid search |
| **Duplicate Detection** | Intelligent compression with similarity scoring |
| **Graph Algorithms** | Shortest path, centrality, connected components, BFS/DFS traversal |
| **Multi-format Export** | JSON, CSV, GraphML, GEXF, DOT, Markdown, Mermaid |
| **Tag Management** | Aliases, bulk operations, and validation |

## Quick Architecture Overview

```
┌────────────────────────────────────────────────────────┐
│              Application / MCP Server                   │
└───────────────────────┬────────────────────────────────┘
                        │ (library usage)
┌───────────────────────┴────────────────────────────────┐
│  Layer 1: ManagerContext (Central Facade)              │
│  ┌──────────────────────────────────────────────────┐  │
│  │ Lazy-initialized access to all managers          │  │
│  └──────────────────────────────────────────────────┘  │
└───────────────────────┬────────────────────────────────┘
                        │ (direct manager access)
┌───────────────────────┴────────────────────────────────┐
│  Layer 2: Specialized Managers                         │
│  • EntityManager     (CRUD + hierarchy + archive)      │
│  • RelationManager   (relation CRUD)                   │
│  • SearchManager     (search + compression + analytics)│
│  • IOManager         (import + export + backup)        │
│  • TagManager        (tag aliases)                     │
│  • GraphTraversal    (graph algorithms)                │
└───────────────────────┬────────────────────────────────┘
                        │
┌───────────────────────┴────────────────────────────────┐
│  Layer 3: Storage Layer                                │
│  GraphStorage (JSONL) or SQLiteStorage (better-sqlite3)│
└────────────────────────────────────────────────────────┘
```

## Data Model

### Entity (Graph Node)
```typescript
interface Entity {
  name: string;           // Unique identifier
  entityType: string;     // Classification (person, project, concept)
  observations: string[]; // Facts/notes about the entity
  parentId?: string;      // Hierarchical parent (optional)
  tags?: string[];        // Categories (lowercase, optional)
  importance?: number;    // Priority 0-10 (optional)
  createdAt?: string;     // ISO 8601 timestamp
  lastModified?: string;  // ISO 8601 timestamp
}
```

### Relation (Graph Edge)
```typescript
interface Relation {
  from: string;         // Source entity name
  to: string;           // Target entity name
  relationType: string; // Relationship type (works_at, knows, etc.)
}
```

## Directory Structure

```
src/ (55+ TypeScript files, ~15,000 lines of code)
├── index.ts              # Entry point, main exports
│
├── core/ (13 files)      # Core managers and storage
│   ├── ManagerContext.ts         # Context holder (lazy init, 7 managers)
│   ├── EntityManager.ts          # Entity CRUD operations
│   ├── RelationManager.ts        # Relation CRUD
│   ├── ObservationManager.ts     # Observation add/delete
│   ├── HierarchyManager.ts       # Parent-child relationships
│   ├── GraphStorage.ts           # JSONL file I/O, caching
│   ├── SQLiteStorage.ts          # SQLite backend (better-sqlite3)
│   ├── StorageFactory.ts         # Storage backend factory
│   ├── TransactionManager.ts     # Batch operations
│   ├── GraphTraversal.ts         # Graph algorithms (BFS, shortest path, centrality)
│   ├── GraphEventEmitter.ts      # Event-driven TF-IDF sync
│   └── index.ts                  # Barrel export
│
├── search/ (30 files)    # Search implementations
│   ├── SearchManager.ts          # Search orchestrator
│   ├── BasicSearch.ts            # Text matching
│   ├── RankedSearch.ts           # TF-IDF scoring
│   ├── BM25Search.ts             # BM25 ranking algorithm
│   ├── BooleanSearch.ts          # AND/OR/NOT logic
│   ├── FuzzySearch.ts            # Levenshtein matching (uses workerpool)
│   ├── SemanticSearch.ts         # Vector similarity search
│   ├── HybridSearchManager.ts    # Three-layer hybrid search
│   ├── EmbeddingService.ts       # OpenAI/Local/Mock embedding providers
│   ├── VectorStore.ts            # In-memory/SQLite vector storage
│   ├── QuantizedVectorStore.ts   # Compressed vector storage
│   ├── TFIDFIndexManager.ts      # TF-IDF index management
│   ├── TFIDFEventSync.ts         # Event-driven TF-IDF updates
│   ├── QueryAnalyzer.ts          # Query understanding + entity extraction
│   ├── QueryPlanner.ts           # Query decomposition + planning
│   ├── QueryPlanCache.ts         # Query plan caching
│   ├── QueryCostEstimator.ts     # Query complexity estimation
│   ├── ParallelSearchExecutor.ts # Parallel search execution
│   ├── EarlyTerminationManager.ts # Result early termination
│   ├── IncrementalIndexer.ts     # Incremental index updates
│   └── index.ts
│
├── features/ (10 files)  # Advanced capabilities
│   ├── TagManager.ts             # Tag aliases
│   ├── IOManager.ts              # Import + export + backup
│   ├── StreamingExporter.ts      # Memory-efficient large exports
│   ├── AnalyticsManager.ts       # Graph stats and validation
│   ├── ArchiveManager.ts         # Entity archival
│   ├── CompressionManager.ts     # Duplicate detection and merging
│   ├── ObservationNormalizer.ts  # Coreference resolution + temporal anchoring
│   ├── KeywordExtractor.ts       # Scored keyword extraction
│   └── index.ts
│
├── types/ (2 files)      # TypeScript definitions
│   ├── types.ts                  # All type definitions
│   └── index.ts                  # Barrel export
│
└── utils/ (10+ files)    # Shared utilities
    ├── schemas.ts                # Zod validation schemas
    ├── constants.ts              # Shared constants
    ├── formatters.ts             # Response formatting
    ├── entityUtils.ts            # Entity helper functions
    ├── searchAlgorithms.ts       # Levenshtein + TF-IDF algorithms
    └── index.ts
```

## Key Design Principles

1. **Context Pattern**: `ManagerContext` holds all managers with lazy-initialized getters
2. **Lazy Initialization**: Managers instantiated on-demand using `??=` operator
3. **Dual Storage Backends**: JSONL (default) or SQLite (via `storageType: 'sqlite'`)
4. **Dependency Injection**: `IGraphStorage` injected into managers for testability
5. **Barrel Exports**: Each module exports through `index.ts`
6. **Worker Parallelism**: Fuzzy search uses `@danielsimonjr/workerpool` for parallel processing
7. **Event-Driven Updates**: `GraphEventEmitter` triggers TF-IDF index updates on entity changes

## Performance Characteristics

- **Entities**: Handles 2,000+ efficiently; 5,000+ with acceptable performance
- **Batch Operations**: Single I/O cycle for bulk operations
- **Caching**: In-memory graph caching with write-through invalidation
- **Duplicate Detection**: O(n²/k) via entityType bucketing (50x faster than naive)
- **Search**: TF-IDF index for relevance ranking; Levenshtein for fuzzy matching
- **SQLite**: FTS5 full-text search with BM25 ranking, WAL mode concurrency

## Storage Files

| File | Purpose |
|------|---------|
| `memory.jsonl` | Main graph (entities + relations) |
| `memory.db` | SQLite database (alternative backend) |
| `*-saved-searches.jsonl` | Saved search queries |
| `*-tag-aliases.jsonl` | Tag synonym mappings |

## Getting Started

```bash
# Install
npm install @danielsimonjr/memoryjs

# Basic usage
import { ManagerContext } from '@danielsimonjr/memoryjs';

const ctx = new ManagerContext({ storagePath: './memory.jsonl' });

// Create entities
await ctx.entityManager.createEntities([
  { name: 'TypeScript', entityType: 'language', observations: ['Typed superset of JavaScript'] }
]);

// Search
const results = await ctx.searchManager.search('TypeScript');
```

## Environment Variables

- `MEMORY_STORAGE_TYPE`: `jsonl` (default) or `sqlite`
- `EMBEDDING_PROVIDER`: `openai`, `local`, or `none` for semantic search
- `OPENAI_API_KEY`: Required when using OpenAI embeddings

## Related Documentation

- **[Architecture Details](./ARCHITECTURE.md)** - In-depth technical architecture
- **[Component Reference](./COMPONENTS.md)** - Complete component documentation
- **[Data Flow](./DATAFLOW.md)** - Data flow patterns
- **[API Reference](./API.md)** - Public API documentation
- **[Test Coverage](./TEST_COVERAGE.md)** - Test coverage analysis

---

**Maintained by**: Daniel Simon Jr.
